# 第8章 静的レンダリングと動的レンダリング
前の章では、ダッシュボードの概要ページのデータを取得しました。しかし、現在のセットアップの2つの限界について簡単に説明しました

データ要求が意図しないウォーターフォールを作り出している。
ダッシュボードは静的なので、データの更新はアプリケーションに反映されません。

## この章では...
この章では、以下のトピックを取り上げます。
* 静的レンダリングとは何か、そしてそれがアプリケーションのパフォーマンスをどのように向上させるか。
* 動的レンダリングとは何か、どのような場合に使用するのか。
* ダッシュボードを動的にするためのさまざまなアプローチ。
* 低速のデータ取得をシミュレートして、何が起こるかを確認します。

## 静的レンダリングとは？
静的レンダリングでは、データのフェッチとレンダリングは、ビルド時（デプロイ時）またはデータの再検証時にサーバー上で行われます。

ユーザーがアプリケーションにアクセスするたびに、キャッシュされた結果が提供されます。静的レンダリングにはいくつかの利点があります

* ウェブサイトの高速化 - プリレンダリングされたコンテンツをキャッシュし、グローバルに配信することができます。これにより、世界中のユーザーがより迅速かつ確実にWebサイトのコンテンツにアクセスできるようになります。
* サーバー負荷の軽減 - コンテンツがキャッシュされるため、サーバーはユーザーのリクエストごとにコンテンツを動的に生成する必要がありません。
* SEO - プリレンダリングされたコンテンツは、ページが読み込まれた時点ですでに利用可能な状態になっているため、検索エンジンのクローラーがインデックスしやすくなります。これにより、検索エンジンのランキングを向上させることができます。

静的レンダリングは、静的なブログ記事や製品ページなど、データのないUIやユーザー間で共有されるデータに有効です。定期的に更新されるパーソナライズされたデータを持つダッシュボードには適していないかもしれません。

静的レンダリングの反対は動的レンダリングです。

## 動的レンダリングとは？
動的レンダリングでは、リクエスト時（ユーザーがページにアクセスした時）に、各ユーザーに対してサーバー上でコンテンツがレンダリングされます。ダイナミックレンダリングにはいくつかの利点があります

* リアルタイムデータ - ダイナミックレンダリングにより、アプリケーションはリアルタイムまたは頻繁に更新されるデータを表示できます。これは、データが頻繁に変更されるアプリケーションに最適です。
* ユーザー固有のコンテンツ - ダッシュボードやユーザープロファイルなど、パーソナライズされたコンテンツを提供し、ユーザーとの対話に基づいてデータを更新することが容易になります。
* リクエスト時の情報 - 動的レンダリングでは、クッキーやURL検索パラメータなど、リクエスト時にしかわからない情報にアクセスできます。

## 遅いデータフェッチのシミュレーション
私たちが作っているダッシュボード・アプリケーションは動的です。

しかし、前の章で述べた問題がまだあります。もし1つのデータリクエストが他のものよりも遅かったらどうなるでしょうか？

遅いデータ・フェッチをシミュレートしてみましょう。data.tsファイルで、fetchRevenue()内のconsole.logとsetTimeoutのコメントを外します

```typescript
// app/lib/data.ts

export async function fetchRevenue() {
  try {
    // We artificially delay a response for demo purposes.
    // Don't do this in production :)
    console.log('Fetching revenue data...');
    await new Promise((resolve) => setTimeout(resolve, 3000));

    const data = await sql<Revenue>`SELECT * FROM revenue`;

    console.log('Data fetch completed after 3 seconds.');

    return data.rows;
  } catch (error) {
    console.error('Database Error:', error);
    throw new Error('Failed to fetch revenue data.');
  }
}
```
新しいタブで http://localhost:3000/dashboard/ を開き、ページの読み込みに時間がかかることに注目してください。ターミナルでは、以下のメッセージも表示されるはずです

```bash
Fetching revenue data...
Data fetch completed after 3 seconds.
```

ここでは、データ取得に時間がかかることをシミュレートするために、人為的に3秒の遅延を追加しています。その結果、データがフェッチされている間、ページ全体が訪問者にUIを表示するのをブロックされてしまいます。そこで、開発者が解決しなければならない一般的な課題に行き着きます

動的レンダリングでは、アプリケーションは最も遅いデータ・フェッチと同じ速度しか出せません。

あなたは第8章を完了した

すばらしい！Next.jsの静的レンダリングと動的レンダリングについて学びました。

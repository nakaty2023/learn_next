# 第14章 アクセシビリティの向上
前の章では、エラー（404エラーを含む）をキャッチし、ユーザーにフォールバックを表示する方法について見てきました。しかし、パズルのもう1つのピースであるフォームバリデーションについてはまだ説明する必要があります。サーバーアクションを使ってサーバーサイドのバリデーションを実装する方法と、ReactのuseActionStateフックを使ってフォームエラーを表示する方法を、アクセシビリティを考慮しながら見ていきましょう！

## この章では...

この章で扱うトピックは次のとおりです。

* Next.jsでeslint-plugin-jsx-a11yを使用してアクセシビリティのベストプラクティスを実装する方法。
* サーバーサイドのフォームバリデーションを実装する方法
* ReactのuseActionStateフックを使用してフォームエラーを処理し、ユーザーに表示する方法。

## アクセシビリティとは何ですか？
アクセシビリティとは、障害のある人を含め、誰もが使用できるWebアプリケーションを設計し、実装することを指します。キーボードナビゲーション、セマンティックHTML、画像、色、動画など、多くの領域をカバーする広大なトピックです。

このコースではアクセシビリティについて深く掘り下げませんが、Next.jsで利用可能なアクセシビリティ機能と、アプリケーションをよりアクセシブルにするための一般的なプラクティスについて説明します。

アクセシビリティについてもっと学びたい方は、web.dev.jpのLearn Accessibilityコースをおすすめします。

## Next.jsでESLintアクセシビリティプラグインを使う
Next.jsでは、アクセシビリティの問題を早期に発見するために、ESLint設定にeslint-plugin-jsx-a11yプラグインが含まれています。たとえば、altテキストがない画像や、aria-*属性やrole属性の間違った使い方などを警告します。

オプションとして、これを試したい場合は、package.jsonファイルにスクリプトとしてnext lintを追加してください

```json
// package.json

"scripts": {
    "build": "next build",
    "dev": "next dev",
    "start": "next start",
    "lint": "next lint"
},
```

それからターミナルで`pnpm lint`を実行する

これはあなたのプロジェクトにESLintをインストールし、設定するためのガイドです。今 pnpm lint を実行すると、次のような出力が表示されるはずです

```bash
✔ No ESLint warnings or errors
```

しかし、altテキストがない画像があったらどうなるでしょうか？調べてみましょう！

/app/ui/invoices/table.tsxに行き、画像からalt propを削除してください。エディタの検索機能を使えば、`<Image>`をすぐに見つけることができます

```tsx
// app/ui/invoices/table.tsx

<Image
  src={invoice.image_url}
  className="rounded-full"
  width={28}
  height={28}
  alt={`${invoice.name}'s profile picture`} // Delete this line
/>
```

もう一度pnpm lintを実行すると、次のような警告が表示されるはずだ

```bash
./app/ui/invoices/table.tsx
45:25  Warning: Image elements must have an alt prop,
either with meaningful text, or an empty string for decorative images. jsx-a11y/alt-text
```

リンターの追加と設定は必須のステップではありませんが、開発プロセスでアクセシビリティの問題を発見するのに役立ちます。

## フォームのアクセシビリティを改善する
以下の3点は、すでにフォームのアクセシビリティを向上させるために行っていることです。

* セマンティックHTML: `<div>` の代わりに `<input>` や `<option>` などのセマンティック要素を使うようにしています。これにより、支援技術（AT）は入力要素に集中でき、ユーザーに適切な文脈情報を提供できます。その結果、フォームの操作や理解が容易になります。
* ラベリング: `<label>` と htmlFor 属性を利用して、各フォームフィールドにわかりやすいテキストラベルを付けています。支援技術への対応が向上するだけでなく、ユーザビリティも向上します。ラベルをクリックすると、対応する入力欄にフォーカスが移るので操作がしやすくなります。
* フォーカスアウトライン: フィールドにフォーカスが当たったとき、アウトラインが正しく表示されるようにスタイリングしています。これはアクセシビリティにおいて非常に重要で、画面上でアクティブな要素がどれかを示し、キーボードやスクリーンリーダーの利用者がフォーム上の現在地を把握しやすくなります。Tabキーを押して動作を確認できます。

これらのプラクティスは、多くのユーザーにとってフォームのアクセシビリティを向上させる重要な土台となります。ただし、フォームのバリデーションやエラー処理については、これらだけでは十分にカバーできません。

## フォームの検証
http://localhost:3000/dashboard/invoices/create へ遷移し、空のフォームを送信します。どうなりますか？

エラーが発生します！これは、空のフォーム値をサーバーアクションに送信しているからです。クライアントまたはサーバーでフォームのバリデーションを行うことで、これを防ぐことができます。

### クライアントサイドのバリデーション
フォームをクライアント側でバリデートする方法はいくつかあります。最も簡単な方法は、フォーム内の `<input>` や `<select>` 要素に required 属性を追加して、ブラウザが提供するフォームバリデーションに依存することです。例えば

```tsx
// app/ui/invoices/create-form.tsx

<input
  id="amount"
  name="amount"
  type="number"
  placeholder="Enter USD amount"
  className="peer block w-full rounded-md border border-gray-200 py-2 pl-10 text-sm outline-2 placeholder:text-gray-500"
  required
/>
```

もう一度フォームを送信してください。空の値でフォームを送信しようとすると、ブラウザは警告を表示する。

ATの中にはブラウザのバリデーションをサポートしているものもあるので、この方法は一般的に問題ありません。

クライアントサイドのバリデーションに代わるものとして、サーバーサイドのバリデーションがあります。次のセクションで実装方法を見てみましょう。とりあえず、必須属性を追加した場合は削除してください。

